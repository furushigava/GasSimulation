# Документация: Графики верификации эргодической гипотезы

## Общее описание
Модуль `update_ergodic_graphs` предоставляет 6 графиков для проверки эргодической гипотезы - фундаментального принципа статистической физики, утверждающего, что **временные средние равны ансамблевым средним** для термодинамических систем в равновесии.

---

## 1. Сходимость временного и ансамблевого средних

### Что это такое?
Сравнение двух способов усреднения физической величины (скорости):
- **Временное среднее** ⟨v⟩ₜ: среднее по времени для одной частицы
- **Ансамблевое среднее** ⟨v⟩ₐₙₛ: среднее по всем частицам в данный момент

### Как читать график:
- **Ось X**: Время
- **Ось Y**: Средняя скорость ⟨v⟩
- **Синяя сплошная линия**: ⟨v⟩ₜ (одна частица, усреднённая по времени)
- **Красная пунктирная линия**: ⟨v⟩ₐₙₛ (все частицы в каждый момент)
- **Зелёная заливка**: Абсолютная разность |Δ| между средними

### Интерпретация:
- **Сближение линий**: ⟨v⟩ₜ → ⟨v⟩ₐₙₛ (эргодичность)
- **Колебания**: Флуктуации в системе
- **Разность |Δ|**: Мера отклонения от эргодичности
- **Стабилизация**: Достижение постоянного значения

### Физический смысл:
- **Эргодичность выполняется**, если линии сходятся
- **Время релаксации**: Время, за которое достигается сходимость
- **Статистическая значимость**: При большом времени наблюдения

---

## 2. Корреляция с начальным состоянием ("забывание")

### Что это такое?
Корреляция Пирсона между начальными и текущими скоростями частиц. Для эргодической системы эта корреляция должна стремиться к нулю со временем.

### Как читать график:
- **Ось X**: Время
- **Ось Y**: Коэффициент корреляции ρ(v₀, v(t))
- **Синяя линия**: Корреляция со временем
- **Красная пунктирная**: Нулевая линия (ρ = 0)
- **Зелёные пунктирные**: Пороги ±0.1
- **Фиолетовая линия**: Экспоненциальный фит ρ ∼ exp(-t/τ)

### Интерпретация:
- **ρ → 0**: Система "забывает" начальные условия (эргодичность)
- **Экспоненциальное затухание**: Характерный признак перемешивания
- **Время корреляции τ**: Характерное время затухания
- **Флуктуации около нуля**: В равновесии

### Физический смысл:
- **Затухание корреляций**: Признак эргодичности
- **Время перемешивания**: Время, за которое ρ падает ниже 0.1
- **Экспоненциальный декорреллятор**: ρ(t) = ρ₀ exp(-t/τ)

---

## 3. Распределение временных средних по частицам

### Что это такое?
Гистограмма временных средних скоростей ⟨v⟩ₜ для разных частиц. При эргодичности это распределение должно быть узким вокруг ансамблевого среднего.

### Как читать график:
- **Ось X**: Временное среднее ⟨v⟩ₜ
- **Ось Y**: Плотность вероятности
- **Синяя гистограмма**: Распределение ⟨v⟩ₜ по частицам
- **Красная вертикальная линия**: Ансамблевое среднее ⟨v⟩ₐₙₛ

### Интерпретация:
- **Узкое распределение**: Все частицы дают примерно одинаковое ⟨v⟩ₜ (эргодичность)
- **Широкое распределение**: Частицы ведут себя по-разному (неэргодичность)
- **Симметричность относительно ⟨v⟩ₐₙₛ**: Признак эргодичности
- **Нормальное распределение**: Центральная предельная теорема

### Статистический смысл:
- **Дисперсия распределения**: Мера эргодических флуктуаций
- **Среднее распределения**: Должно совпадать с ⟨v⟩ₐₙₛ
- **Теорема Биркгофа-Хинчина**: Для эргодических систем

---

## 4. Относительная ошибка сходимости

### Что это такое?
Относительная разность между временным и ансамблевым средними в процентах:
\[ \epsilon(t) = \frac{|⟨v⟩_t - ⟨v⟩_{анс}|}{|⟨v⟩_{анс}|} \times 100\% \]

### Как читать график:
- **Ось X**: Время
- **Ось Y**: Относительная ошибка ε(t) (%) (логарифмическая шкала)
- **Синяя линия**: ε(t) со временем
- **Красная пунктирная**: Порог 5%
- **Логарифмическая шкала**: Показывает порядки величины

### Интерпретация:
- **ε(t) → 0**: Сходимость к эргодичности
- **Скорость убывания**: Характеризует скорость сходимости
- **Стабилизация**: Достижение предельной точности
- **Флуктуации**: Статистический шум

### Критерии сходимости:
- **ε < 5%**: Практическая сходимость
- **ε < 1%**: Хорошая сходимость
- **ε < 0.1%**: Отличная сходимость

---

## 5. Фазовое пространство (v vs x)

### Что это такое?
Диаграмма рассеяния частиц в координатах (позиция, скорость). Позволяет визуализировать траектории частиц.

### Как читать график:
- **Ось X**: Координата x частицы
- **Ось Y**: Скорость v частицы
- **Цветные точки**: Текущие состояния частиц (цвет по индексу)
- **Красные кресты**: Начальные состояния (если доступны)
- **Цветовая карта**: Разные частицы

### Интерпретация:
- **Разброс точек**: Хаотическое движение
- **Отсутствие паттернов**: Признак перемешивания
- **Корреляция x-v**: Возможные пространственные градиенты
- **Сравнение с начальными условиями**: Эволюция системы

### Физический смысл:
- **Фазовый портрет**: Визуализация динамики
- **Перемешивание**: Точки равномерно заполняют доступную область
- **Граничные эффекты**: Влияние стенок на распределение

---

## 6. Статистика эргодичности

### Что это такое?
Текстовая панель с ключевыми метриками и выводом о выполнении эргодической гипотезы.

### Содержимое:

#### Параметры системы:
- **Частиц N**: Число частиц в системе
- **Измерений**: Количество временных точек

#### Текущие значения:
- **⟨v⟩_время**: Текущее временное среднее
- **⟨v⟩_ансамбль**: Текущее ансамблевое среднее
- **|Δ|**: Абсолютная и относительная разность

#### Забывание начальных условий:
- **ρ(v₀, v(t))**: Текущая корреляция
- **Оценка**: "Забывание достигнуто" (|ρ| < 0.1) или "Идёт релаксация"
- **Время перемешивания**: Оценка времени затухания корреляции

#### Вывод об эргодичности:
- **✓ ПОДТВЕРЖДЕНА**: ⟨A⟩ₜ ≈ ⟨A⟩ₐₙₛ (разность < 10%)
- **⚠ Сходимость не достигнута**: Требуется больше времени
- **⏳ Мало данных**: Недостаточно измерений

---

## Теоретические основы

### Формальное определение эргодичности:
\[ \lim_{T \to \infty} \frac{1}{T} \int_0^T A(q(t), p(t)) dt = \langle A \rangle_{\text{микроканонический}} \]
где левая часть - временное среднее, правая - ансамблевое.

### Метрики эргодичности:

1. **Сходимость средних**:
\[ \Delta(t) = |\langle v \rangle_t - \langle v \rangle_{ens}| \to 0 \]

2. **Затухание корреляций**:
\[ C(t) = \langle v_i(0) v_i(t) \rangle \to 0 \]

3. **Распределение временных средних**:
\[ \text{Var}(\langle v \rangle_t^{(i)}) \to 0 \quad \text{при} \quad t \to \infty \]

### Временные масштабы:
- **Время корреляции τ_c**: Время затухания автокорреляций
- **Время перемешивания τ_mix**: Время достижения |ρ| < 0.1
- **Время сходимости τ_conv**: Время достижения ε < 5%

---

## Физическая интерпретация

### Что означает эргодичность на практике?

1. **Одна частица = весь ансамбль**:
   - Долгое наблюдение за одной частицей эквивалентно мгновенному снимку всех частиц
   - Частица "посещает" все доступные состояния

2. **Независимость от начальных условий**:
   - Система "забывает", с чего началась
   - Финальное состояние зависит только от сохраняющихся величин (энергия, импульс)

3. **Равновесные свойства**:
   - Временные средние стабилизируются
   - Флуктуации становятся малыми и предсказуемыми

### Условия эргодичности:

1. **Хаотичность**: Сильное перемешивание в фазовом пространстве
2. **Связность**: Все области фазового пространства достижимы
3. **Время наблюдения**: T ≫ τ_c (гораздо больше времени корреляции)
4. **Размер системы**: Достаточно большой для статистики

---

## Наблюдаемые явления

### 1. Сходимость средних:
- Вначале ⟨v⟩ₜ и ⟨v⟩ₐₙₛ могут сильно различаться
- Со временем они сходятся к общему значению
- Скорость сходимости зависит от:
  - Числа частиц
  - Температуры
  - Начальных условий

### 2. Затухание корреляций:
- Начальная корреляция может быть высокой
- Экспоненциальное затухание: ρ(t) ∼ exp(-t/τ)
- Время затухания τ характеризует "память" системы

### 3. Распределение средних:
- При малом времени: широкое распределение
- При большом времени: узкое распределение вокруг ⟨v⟩ₐₙₛ
- Форма распределения стремится к нормальной

### 4. Флуктуации в равновесии:
- Даже в равновесии есть флуктуации
- Их амплитуда ∼ 1/√N
- Время жизни ∼ τ_c

---

## Практическое использование

### Для демонстрации эргодичности:

1. **Выберите достаточно большое время наблюдения**
   - T > 10 × τ_c
   - Чем больше T, тем лучше сходимость

2. **Следите за сходимостью средних** (график 1)
   - Линии должны сблизиться
   - Разность |Δ| должна уменьшиться

3. **Проверьте затухание корреляций** (график 2)
   - ρ(t) должен упасть ниже 0.1
   - Экспоненциальный фит должен хорошо описывать данные

### Для количественных измерений:

1. **Измерьте время корреляции τ**:
   - Из наклона ln|ρ(t)| vs t
   - Как время, за которое ρ падает в e раз

2. **Определите время сходимости**:
   - Время достижения ε < 5%
   - Зависит от размера системы

3. **Проанализируйте распределение средних**:
   - Ширина распределения должна уменьшаться со временем
   - Среднее распределения должно стремиться к ⟨v⟩ₐₙₛ

### Для исследования неэргодичности:

1. **Системы с ловушками**:
   - Частицы могут "застревать" в определённых состояниях
   - Распределение ⟨v⟩ₜ будет бимодальным

2. **Системы с медленной релаксацией**:
   - Время сходимости очень большое
   - Практически неэргодичны на доступных временах

3. **Системы с сохраняющимися величинами**:
   - Некоторые начальные условия никогда не забываются
   - Корреляция не затухает до нуля

---

## Важные замечания

### Ограничения и предостережения:

1. **Конечное время наблюдения**:
   - На практике T конечно
   - Всегда остаётся остаточная ошибка ∼ 1/√T

2. **Размер системы**:
   - В малых системах флуктуации значительны
   - Эргодичность - статистическое понятие

3. **Начальные условия**:
   - Некоторые начальные условия могут приводить к неэргодичному поведению
   - Важно усреднять по разным начальным условиям

4. **Время релаксации**:
   - Может быть экспоненциально большим в некоторых системах
   - Практическая неэргодичность

### Связь с другими концепциями:

1. **Перемешивание (mixing)**:
   - Более сильное условие, чем эргодичность
   - Означает экспоненциальное затухание корреляций

2. **Неравновесная статистика**:
   - Эргодичность предполагает равновесие
   - В неравновесных системах может нарушаться

3. **Квантовые системы**:
   - Квантовая эргодичность сложнее классической
   - Существуют квантовые неэргодические системы

### Образовательная ценность:

1. **Фундаментальный принцип** статистической физики
2. **Мост между** микроскопической и макроскопической физикой
3. **Практическое применение** в компьютерном моделировании
4. **Понимание пределов** предсказуемости физических систем

Эти графики вместе образуют комплексный инструмент для проверки эргодической гипотезы, позволяя не только качественно оценить выполнение этого принципа, но и количественно измерить ключевые параметры: время корреляции, скорость сходимости и степень перемешивания системы.