# Графики и визуализации

---
[← README](../README.md) | [Физика](physics.md) | [Математика](mathematics.md) | [Реализация](implementation.md) | [Параметры](parameters.md) | **Графики**

---

## Содержание

- [Обзор](#обзор)
- [Вкладка 1: Термодинамика](#вкладка-1-термодинамика)
- [Вкладка 2: Распределения](#вкладка-2-распределения)
- [Вкладка 3: Кинетика](#вкладка-3-кинетика)
- [Вкладка 4: Корреляции](#вкладка-4-корреляции)
- [Вкладка 5: Расширенный анализ](#вкладка-5-расширенный-анализ)
- [Вкладка 6: Реальное время](#вкладка-6-реальное-время)
- [Вкладка 7: Сохранение энергии](#вкладка-7-сохранение-энергии)
- [Вкладка 8: Броуновское движение](#вкладка-8-броуновское-движение)
- [Вкладка 9: Распределение Больцмана](#вкладка-9-распределение-больцмана)
- [Вкладка 10: Энтропия](#вкладка-10-энтропия)
- [Вкладка 11: Эргодичность](#вкладка-11-эргодичность)
- [Вкладка 12: Вращательные степени свободы](#вкладка-12-вращательные-степени-свободы)

---

## Обзор

Окно графиков (`GraphWindow`) содержит 12 вкладок для визуализации различных физических величин и проверки теоретических законов.

| № | Вкладка | Физический закон / явление | Файл |
|---|---------|---------------------------|------|
| 1 | Термодинамика | P-V-T соотношения | `thermodynamic.py` |
| 2 | Распределения | Максвелл | `distribution.py` |
| 3 | Кинетика | Столкновения, свободный пробег | `kinetic.py` |
| 4 | Корреляции | Статистические связи | `correlation.py` |
| 5 | Расширенный | Спектральный анализ | `advanced.py` |
| 6 | Реальное время | Мгновенные значения | `realtime.py` |
| 7 | Энергия | 1-й закон термодинамики | `energy_conservation.py` |
| 8 | Броуновское | Диффузия, MSD | `brownian.py` |
| 9 | Больцман | Барометрическая формула | `boltzmann.py` |
| 10 | Энтропия | 2-й закон, H-теорема | `entropy.py` |
| 11 | Эргодичность | Временны́е vs ансамблевые средние | `ergodic.py` |
| 12 | Вращение | Распределение ω, равнораспределение | `rotational.py` |

---

## Вкладка 1: Термодинамика

**Файл**: `graphs/thermodynamic.py`

### Назначение

Визуализация термодинамических соотношений между давлением, объёмом и температурой.

### Графики

| График | Оси | Описание |
|--------|-----|----------|
| P-T диаграмма | P(T) | Зависимость давления от температуры при постоянном объёме |
| P-V диаграмма | P(V) | Зависимость давления от объёма (изотермы, адиабаты) |
| V-T диаграмма | V(T) | Зависимость объёма от температуры при постоянном давлении |

### Теоретические соотношения

Для идеального газа:
```math
PV = Nk_B T
```

**Изохорный процесс** (V = const): $P \propto T$

**Изотермический процесс** (T = const): $PV = const$

**Изобарный процесс** (P = const): $V \propto T$

### Рекомендации

- Используйте режимы `heat`, `freeze`, `expansion`, `compression` для наблюдения процессов
- Комбинированные режимы показывают политропные процессы

---

## Вкладка 2: Распределения

**Файл**: `graphs/distribution.py`

### Назначение

Проверка распределения Максвелла по скоростям.

### Графики

| График | Описание |
|--------|----------|
| Гистограмма скоростей | Экспериментальное распределение |
| Теоретическая кривая | Распределение Максвелла (2D) |
| Результаты тестов | χ² и KS статистики |

### Теоретическое распределение (2D)

```math
f(v) = \frac{mv}{k_B T} \exp\left(-\frac{mv^2}{2k_B T}\right)
```

### Методы верификации

| Тест | Метод | Критерий согласия |
|------|-------|------------------|
| χ² (хи-квадрат) | Сравнение частот в интервалах | $\chi^2 < \chi^2_{crit}$ |
| Колмогорова-Смирнова | Максимальное отклонение CDF | $D_n < D_{crit}$ |

### Отображаемые величины

- **Температура** $T$ — расчётная из средней энергии
- **Характерные скорости**: $v_p$, $\langle v \rangle$, $v_{rms}$
- **p-value** тестов — вероятность случайного отклонения

### Рекомендации

- Для хорошей статистики используйте N > 100 частиц
- Дождитесь установления равновесия (> 100 столкновений)
- Изолированная система даёт более стабильные результаты

---

## Вкладка 3: Кинетика

**Файл**: `graphs/kinetic.py`

### Назначение

Анализ кинетических характеристик газа.

### Графики

| График | Величина | Формула |
|--------|----------|---------|
| Средний свободный пробег | $\lambda$ | $\lambda = \frac{1}{\sqrt{2} n \sigma}$ |
| Частота столкновений | $Z$ | $Z = n \sigma \langle v \rangle$ |
| История столкновений | $N_{coll}(t)$ | Кумулятивное число |

### Теоретические формулы

**Средний свободный пробег** (2D):
```math
\lambda = \frac{1}{\sqrt{2} \cdot n \cdot 2R}
```
где $n = N/V$ — концентрация, $R$ — радиус частицы.

**Частота столкновений одной частицы**:
```math
Z_1 = \sqrt{2} \cdot n \cdot 2R \cdot \langle v \rangle
```

**Полная частота столкновений в системе**:
```math
Z_{total} = \frac{1}{2} N Z_1
```

### Рекомендации

- Увеличьте радиус частиц для наблюдения большего числа столкновений
- При высокой плотности (много частиц в малом объёме) $\lambda$ уменьшается

---

## Вкладка 4: Корреляции

**Файл**: `graphs/correlation.py`

### Назначение

Анализ статистических корреляций между физическими величинами.

### Графики

| График | Переменные | Описание |
|--------|------------|----------|
| E-T корреляция | $E$ vs $T$ | Связь энергии и температуры |
| P-V корреляция | $P$ vs $V$ | Связь давления и объёма |
| Корреляционная матрица | Все пары | Тепловая карта коэффициентов |

### Коэффициент корреляции Пирсона

```math
r = \frac{\sum (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum (x_i - \bar{x})^2 \sum (y_i - \bar{y})^2}}
```

| Значение r | Интерпретация |
|------------|---------------|
| 0.9–1.0 | Очень сильная положительная |
| 0.7–0.9 | Сильная положительная |
| 0.4–0.7 | Умеренная положительная |
| 0.0–0.4 | Слабая или отсутствует |
| < 0 | Отрицательная корреляция |

### Ожидаемые корреляции

- **E и T**: сильная положительная ($r \approx 1$)
- **P и V**: отрицательная при T = const (изотерма)
- **P и T**: положительная при V = const (изохора)

---

## Вкладка 5: Расширенный анализ

**Файл**: `graphs/advanced.py`

### Назначение

Продвинутые методы анализа динамики системы.

### Графики

| График | Метод | Описание |
|--------|-------|----------|
| Спектр мощности | FFT | Частотный анализ колебаний |
| Фрактальная размерность | Box-counting | Хаотичность траекторий |
| Показатель Ляпунова | Расхождение траекторий | Чувствительность к начальным условиям |

### Спектральный анализ

Быстрое преобразование Фурье (FFT) временны́х рядов:
```math
X(f) = \int_{-\infty}^{\infty} x(t) e^{-2\pi i f t} dt
```

Спектр мощности: $S(f) = |X(f)|^2$

### Фрактальная размерность

Метод box-counting:
```math
D = \lim_{\epsilon \to 0} \frac{\log N(\epsilon)}{\log(1/\epsilon)}
```

где $N(\epsilon)$ — число ячеек размера $\epsilon$, покрывающих траекторию.

---

## Вкладка 6: Реальное время

**Файл**: `graphs/realtime.py`

### Назначение

Мониторинг мгновенных значений физических величин.

### Графики

| График | Величина | Обновление |
|--------|----------|------------|
| E(t) | Полная энергия | Каждый шаг |
| T(t) | Температура | Каждый шаг |
| P(t) | Давление | Каждый шаг |
| V(t) | Объём | Каждый шаг |

### Особенности

- Скользящее окно для отображения последних N точек
- Автомасштабирование осей
- Маркеры событий (столкновения, изменения режима)

### Рекомендации

- Используйте для наблюдения переходных процессов
- Флуктуации уменьшаются с ростом числа частиц

---

## Вкладка 7: Сохранение энергии

**Файл**: `graphs/energy_conservation.py`

### Назначение

Проверка первого закона термодинамики в изолированной системе.

### Графики

| График | Описание |
|--------|----------|
| $E_{total}(t)$ | Полная энергия от времени |
| $E_{kin}(t)$, $E_{pot}(t)$ | Компоненты энергии |
| Относительная ошибка | $\Delta E / E_0$ |

### Проверяемый закон

В изолированной системе:
```math
E_{total} = E_{kin} + E_{pot} + E_{grav} = const
```

### Метрики верификации

| Метрика | Формула | Допустимое значение |
|---------|---------|---------------------|
| Относительная ошибка | $\delta = \|E(t) - E_0\| / E_0$ | < 1% |
| Дрейф | $dE/dt$ | ≈ 0 |
| Флуктуации | $\sigma_E / \langle E \rangle$ | < 0.1% |

### Рекомендации

- **Включите режим «Изолированная система»**
- Отключите все режимы изменения состояния
- Меньший шаг времени `dt` улучшает сохранение

---

## Вкладка 8: Броуновское движение

**Файл**: `graphs/brownian.py`

### Назначение

Анализ диффузии и броуновского движения крупной частицы.

### Графики

| График | Описание |
|--------|----------|
| Траектория | $x(t)$, $y(t)$ в плоскости |
| MSD(t) | Среднеквадратичное смещение |
| Fit | Линейная аппроксимация MSD |

### Среднеквадратичное смещение

```math
\langle r^2(t) \rangle = \langle |\vec{r}(t) - \vec{r}(0)|^2 \rangle = 4Dt
```

### Определение коэффициента диффузии

Из наклона графика MSD(t):
```math
D = \frac{1}{4} \cdot \frac{d\langle r^2 \rangle}{dt}
```

### Отображаемые величины

- Коэффициент диффузии $D$
- Среднее смещение
- Качество линейной аппроксимации ($R^2$)

### Рекомендации

- **Включите «Броуновский режим»**
- Используйте большое отношение масс (> 10)
- Для хорошей статистики нужно много столкновений

---

## Вкладка 9: Распределение Больцмана

**Файл**: `graphs/boltzmann.py`

### Назначение

Проверка барометрической формулы в поле тяжести.

### Графики

| График | Описание |
|--------|----------|
| Гистограмма по высоте | $n(h)$ — распределение частиц |
| Теоретическая экспонента | $n_0 e^{-mgh/k_BT}$ |
| Логарифмический график | $\ln(n)$ vs $h$ — проверка линейности |

### Барометрическая формула

```math
n(h) = n_0 \exp\left(-\frac{mgh}{k_B T}\right)
```

В логарифмическом масштабе:
```math
\ln(n) = \ln(n_0) - \frac{mg}{k_B T} \cdot h
```

### Метод верификации

1. Построить график $\ln(n)$ от $h$
2. Выполнить линейную регрессию
3. Определить наклон $k = -mg/k_BT$
4. Сравнить с теоретическим значением

### Рекомендации

- **Включите гравитацию**
- Используйте достаточную высоту контейнера
- Дождитесь установления равновесия

---

## Вкладка 10: Энтропия

**Файл**: `graphs/entropy.py`

### Назначение

Проверка второго закона термодинамики и H-теоремы.

### Графики

| График | Величина | Ожидаемое поведение |
|--------|----------|---------------------|
| $S_v(t)$ | Энтропия по скоростям | Рост → насыщение |
| $S_{space}(t)$ | Пространственная энтропия | Рост → насыщение |
| $H(t)$ | H-функция Больцмана | Убывание |

### Формулы энтропии

**По скоростям**:
```math
S_v = -k_B \sum_i p_i \ln(p_i)
```

**Пространственная**:
```math
S_{space} = -k_B \sum_{i,j} p_{ij} \ln(p_{ij})
```

**H-функция**:
```math
H = \int f \ln(f) \, dv
```

### H-теорема Больцмана

```math
\frac{dH}{dt} \leq 0
```

H-функция монотонно убывает (или остаётся постоянной в равновесии).

### Рекомендации

- **Включите «Старт из угла»** для наглядной демонстрации
- В изолированной системе энтропия достигает максимума
- Флуктуации энтропии уменьшаются с ростом N

---

## Вкладка 11: Эргодичность

**Файл**: `graphs/ergodic.py`

### Назначение

Проверка эргодической гипотезы — равенства временны́х и ансамблевых средних.

### Графики

| График | Описание |
|--------|----------|
| Временно́е среднее | $\langle A \rangle_t$ для выбранной частицы |
| Ансамблевое среднее | $\langle A \rangle_{ens}$ по всем частицам |
| Разность | $\|\langle A \rangle_t - \langle A \rangle_{ens}\|$ |
| Автокорреляция | $C(\tau) = \langle A(t)A(t+\tau) \rangle$ |

### Эргодическая гипотеза

```math
\lim_{T \to \infty} \frac{1}{T} \int_0^T A(t) \, dt = \langle A \rangle_{ens}
```

### Автокорреляционная функция

```math
C(\tau) = \langle \delta A(t) \cdot \delta A(t+\tau) \rangle
```

где $\delta A = A - \langle A \rangle$.

**Время корреляции**:
```math
\tau_c = \int_0^\infty C(\tau) \, d\tau
```

### Критерии эргодичности

| Критерий | Описание |
|----------|----------|
| Сходимость средних | $\langle A \rangle_t \to \langle A \rangle_{ens}$ |
| Затухание корреляций | $C(\tau) \to 0$ при $\tau \to \infty$ |
| Забывание начальных условий | Независимость от $A(0)$ |

### Рекомендации

- Используйте достаточно долгое время симуляции
- Сравнивайте разные физические величины (v², E, и др.)

---

## Вкладка 12: Вращательные степени свободы

**Файл**: `graphs/rotational.py`

### Назначение

Анализ вращательного движения многоатомных молекул.

### Графики

| График | Описание |
|--------|----------|
| Распределение $\omega$ | Гистограмма угловых скоростей |
| $E_{rot}(t)$ | Вращательная энергия системы |
| Равнораспределение | $\langle E_{trans} \rangle$ vs $\langle E_{rot} \rangle$ |

### Теорема о равнораспределении

Для молекулы с $f$ степенями свободы:
```math
\langle E \rangle = \frac{f}{2} k_B T
```

В 2D для двухатомной молекулы:
- 2 поступательные степени свободы: $\langle E_{trans} \rangle = k_B T$
- 1 вращательная степень свободы: $\langle E_{rot} \rangle = \frac{1}{2} k_B T$

### Распределение угловых скоростей

Для равновесной системы (аналог Максвелла):
```math
f(\omega) \propto \exp\left(-\frac{I\omega^2}{2k_B T}\right)
```

### Проверка равнораспределения

| Величина | Ожидаемое значение |
|----------|-------------------|
| $\langle E_{trans} \rangle / \langle E_{rot} \rangle$ | 2 (для 2D) |
| $\langle E_{rot} \rangle$ | $\frac{1}{2} k_B T$ |

### Рекомендации

- **Включите вращение** в настройках молекул
- Используйте двухатомные или многоатомные молекулы
- Дождитесь термализации вращательных степеней свободы

---

## Экспорт данных

Все графики поддерживают экспорт:

| Формат | Описание | Метод |
|--------|----------|-------|
| PNG/SVG | Изображения графиков | Кнопка «Сохранить» |
| CSV | Числовые данные | Меню «Экспорт» |
| JSON | Полное состояние | Меню «Экспорт» |

---

[← README](../README.md) | [Физика](physics.md) | [Математика](mathematics.md) | [Реализация](implementation.md) | [Параметры](parameters.md) | **Графики**
